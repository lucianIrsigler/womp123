<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Room</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
      }

      #center {
        display: flex;
        justify-content: center;
        text-align: center;
        align-items: center;
      }

      #buffer {
        height: 10vh;
      }

      #container {
        position: relative;
        /* width: 30vh; */
        height: 20vh;
        aspect-ratio: 1/1;
        border: 5px solid #333;
        border-radius: 50%;
        overflow: hidden;
        background-color: #fff;
      }

      #ball {
        position: absolute;
        /* width: 5vh; */
        height: 4vh;
        aspect-ratio: 1/1;
        background-color: red;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      #game {
        padding-left: 90px;
      }
    </style>
    <link rel="stylesheet" href="grid.css" />
    <link rel="stylesheet" href="indexstyle.css" />
  </head>

  <body>
    <div id="main-menu">
      <h1>Welcome to the Game</h1>
      <button id="create-room">Start a Room</button>
      <button id="join-room">Join a Room</button>
    </div>

    <div id="join-form" style="display: none">
      <input type="text" id="player-name" placeholder="Enter your name" />
      <input type="text" id="room-code" placeholder="Enter room code" />
      <button id="submit-join">Join</button>
    </div>

    <div id="lobby" style="display: none">
      <h2>Lobby</h2>
      <p>Room Code: <span id="room-code-display"></span></p>
      <p id="room-status"></p>
      <h3>Players:</h3>
      <ul id="player-list"></ul>
      <!--CHANGED-->
      <button id="start-game" style="display: none">Start Game</button>
    </div>

    <h2 id="game-start-title" style="display: none">Game Started!</h2>

    <div id="game" style="display: none">
      <div id="center">
        <div id="game">
          <div id="maze"></div>
        </div>
      </div>
      <div id="gyroscope-data" style="display: none"></div>
    </div>

    <div id="buffer">
      <div id="ballXCoordinate"></div>
      <div id="ballYCoordinate"></div>
      <div id="gyroRadius"></div>
    </div>

    <div id="container">
      <div id="ball"></div>
    </div>

    <!-- <div id="buffer">
      <div id="ballXCoordinate"></div>
      <div id="ballYCoordinate"></div>
      <div id="gyroRadius"></div>
    </div> -->

    <script>
      const container = document.getElementById("container");
      const ball = document.getElementById("ball");
      const containerRadius = container.offsetWidth / 2;
      const ballRadius = ball.offsetWidth / 2;
      const maxOffset = containerRadius - ballRadius;

      let x = 0,
        y = 0; // Ball's position
      let vx = 0,
        vy = 0; // Ball's velocity

      function handleOrientation(event) {
        const beta = event.beta; // In degree in the range [-180,180)
        const gamma = event.gamma; // In degree in the range [-90,90)

        // Normalize the values
        const ax = gamma / 90; // Normalize to range [-1,1]
        const ay = beta / 90; // Normalize to range [-1,1]

        // Update velocity
        vx += ax * 0.5; // Adjust multiplier for acceleration
        vy += ay * 0.5; // Adjust multiplier for acceleration
      }

      function updatePosition() {
        // Update position
        x += vx;
        y += vy;

        // Set boundaries so the ball doesn't go out of the circle
        const distance = Math.sqrt(x * x + y * y);
        if (distance > maxOffset) {
          const angle = Math.atan2(y, x);
          x = maxOffset * Math.cos(angle);
          y = maxOffset * Math.sin(angle);

          // Stop velocity on boundary hit
          vx = 0;
          vy = 0;
        }

        ball.style.transform = `translate(${x}px, ${y}px) translate(-50%, -50%)`;

        requestAnimationFrame(updatePosition);
      }

      window.addEventListener("deviceorientation", handleOrientation);
      requestAnimationFrame(updatePosition);
    </script>

    <script src="client.js"></script>
    <script src="ball.js" defer></script>
    <script src="https://run.confettipage.com/here.js" data-confetticode="U2FsdGVkX193SRz5o4fFcUHMHJJvxpt2vQCYghfcVCdr399Z79MQ5pmQ+z2v+FfKcnahFUixSNjtjN3ArOvIeTzljBRex/gd3TlV1AWlOjQAVhTlMbWJw2/vRPrxBQKAu6RGdPgnAMsx1d/6Rq8hY28f6WvqyIKQPtBl1vOWY4soLG9CQrvb5VTcwtihPQJCFq//RBdB1/CqxZQVefY7zviv+Ed7tZqyIeaaBUiC2RRXShhisxK1ImjA5+BGsDzMA9jwkPmxWY7qDQLR2q39g7+IDhWFiK6HOGu9bJUCH10d06Ws01cY/xTRValV1SL/nxmvp3BQ/uXTbDo3BjAbaZoSuxZVGF0Pa7cyXbxIU/EiHXYIkXTRmLT05fQw2eUM7ffk4LKzFcL5ZLMVSUlQlYb4ciEru6m50m5G2By7NtL4DuJOYG7Rrv3o3o0nDYgXtmuKJy+4xoBQ4o/5ll7MuvQPc2ecXuXvlVYW+cXS3Jj0u0ZRs1oA9ogGB9KkpSAOC2Hp4YWAHOFniMQGtCwf6+i5IQkvT7lGhVdSLQVWDxXcppvVH79Tiof/c3qdbp0LYwLZcYQOy9EzJnmRlLup5G+SUwLnQIbsPVMLWOvPSOmF2vG/nrsI3sprks9i1XD8p1OTPOi6lG6yNE1gVYDg2Qa7+8jC8aWoz77adI+PjumLTrDE40T+52PmHzAqTP9c"></script>
    
    <!-- <script src="tilt_game.js"></script> -->
  </body>
</html>